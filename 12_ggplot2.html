<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Devon P. Ryan" />

<meta name="date" content="2023-03-10" />

<title>Advanced plotting with ggplot2</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Rintro 2023</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Modules
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00_Introduction.html">00_Introduction</a>
    </li>
    <li>
      <a href="01_FirstSteps.html">01_FirstSteps</a>
    </li>
    <li>
      <a href="02_HighDimData.html">02_HighDimData</a>
    </li>
    <li>
      <a href="03_GettingData.html">03_GettingData</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="04_DataDescriptions.html">04_DataDescriptions</a>
    </li>
    <li>
      <a href="05_DataModels.html">05_DataModels</a>
    </li>
    <li>
      <a href="06_DataVisualization.html">06_DataVisualization</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="10_tidyr.html">10_tidyr</a>
    </li>
    <li>
      <a href="11_dplyr.html">11_dplyr</a>
    </li>
    <li>
      <a href="12_ggplot2.html">12_ggplot2</a>
    </li>
    <li class="divider"></li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/maxplanck-ie/Rintro/tree/2023.03">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Advanced plotting with ggplot2</h1>
<h4 class="author">Devon P. Ryan</h4>
<h4 class="date">2023-03-10</h4>

</div>


<div id="initial-setup" class="section level1">
<h1>Initial setup</h1>
<p>If you’ve started a new session, please first do the following:</p>
<pre class="r"><code>library(&quot;readr&quot;)
library(&quot;tidyr&quot;)
library(&quot;dplyr&quot;, warn.conflicts = FALSE)

d = read_csv(&quot;../data/foodIntake2.csv&quot;, skip=1)</code></pre>
<pre><code>## New names:
## Rows: 33 Columns: 37
## -- Column specification
## -------------------------------------------------------- Delimiter: &quot;,&quot; dbl
## (36): ...1, 528, 535, 559, 563, 570, 571, 572, 573, 583, 593, 595, 599, ... lgl
## (1): ...20
## i Use `spec()` to retrieve the full column specification for this data. i
## Specify the column types or set `show_col_types = FALSE` to quiet this message.
## * `` -&gt; `...1`
## * `` -&gt; `...20`</code></pre>
<pre class="r"><code>colnames(d)[c(1,20)] = c(&quot;Week&quot;, &quot;Skip&quot;)
d2 = d %&gt;% select(-Skip) %&gt;% gather(Cage, Value, -Week)
d2$Group = c(rep(rep(&quot;Control&quot;, 33), 18), rep(rep(&quot;Treatment&quot;, 33), 17))</code></pre>
<p>This is the messy “food intake in two groups of mice over time”
dataset from the tidyr section.</p>
<p>Also, load/install ggplot2</p>
<pre class="r"><code>#install.packages(&quot;ggplot2&quot;) #If you need it
library(ggplot2)</code></pre>
<pre><code>## 
## Attaching package: &#39;ggplot2&#39;</code></pre>
<pre><code>## The following object is masked _by_ &#39;.GlobalEnv&#39;:
## 
##     msleep</code></pre>
</div>
<div id="rationale" class="section level1">
<h1>Rationale</h1>
<blockquote>
<ul>
<li>R’s base graphics have inconsistent naming/formatting
<ul>
<li>It can get difficult to do anything fancy</li>
</ul></li>
<li>The “grammar of graphics” better describes how most people think
<ul>
<li>A dataset</li>
<li>A coordinate system (an X and maybe a Y)</li>
<li>Some sort of geometric object (lines, points, bars, etc.)</li>
</ul></li>
<li>ggplot2 is extremely flexible and powerful
<ul>
<li>Consistent naming/formatting</li>
<li>Steeper learning curve</li>
</ul></li>
<li>There are a number of extensions built upon ggplot2 (e.g., ggbio,
plotly)</li>
</ul>
</blockquote>
<p>N.B., this document is heavily influenced by the Data Carpentry <a
href="https://github.com/datacarpentry/R-ecology-lesson/blob/instructor_notes/05-visualization-ggplot2.Rmd">ggplot2
presentation</a></p>
</div>
<div id="the-ggplot2-process" class="section level1">
<h1>The ggplot2 process</h1>
<p>ggplot2 uses dataframe with multiple columns to create complex plots.
The defaults are generally more or less publication ready (see some of
the themes above for improvements).</p>
<p>Graphic are created step by stey by adding new elements (plots, axis
labels, range changes, etc.).</p>
<p>To build a ggplot we need to:</p>
<ul>
<li>bind the plot to a specific data frame using the <code>data</code>
argument</li>
</ul>
<pre class="r"><code>ggplot(data = d2)</code></pre>
<ul>
<li>define aesthetics (<code>aes</code>), that maps variables in the
data to axes on the plot or to plotting size, shape, color, etc.,</li>
</ul>
<pre class="r"><code>ggplot(data = d2, aes(x = Week, y = Value))</code></pre>
<ul>
<li>add <code>geoms</code> – graphical representation of the data in the
plot (points, lines, bars). To add a geom to the plot use <code>+</code>
operator:</li>
</ul>
<pre class="r"><code>ggplot(data = d2, aes(x = Week, y = Value)) +
  geom_point()</code></pre>
<pre><code>## Warning: Removed 326 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<ul>
<li>These <code>geoms</code> often have additional aesthetics:</li>
</ul>
<p>Notes:</p>
<ul>
<li>Anything you put in the <code>ggplot()</code> function can be seen
by any geom layers that you add. i.e. these are universal plot
settings</li>
<li>This includes the x and y axis you set up in <code>aes()</code></li>
<li>The column names are used as the default axis labels!</li>
</ul>
</div>
<div id="modifying-plots" class="section level1">
<h1>Modifying plots</h1>
<p>One extremely useful feature is to be able to change aesthetics
according to columns in a dataframe.</p>
<pre class="r"><code>ggplot(data = d2, aes(x = Week, y = Value)) +
  geom_point(aes(color=Group, shape=Group))</code></pre>
<pre><code>## Warning: Removed 326 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<ul>
<li>You can use <code>colour</code> if you prefer</li>
<li>Legends are automatically added</li>
</ul>
<p>Things such as transparency can also be added:</p>
<pre class="r"><code>ggplot(data = d2, aes(x = Week, y = Value)) +
  geom_point(alpha=0.5, aes(color=Group, shape=Group))</code></pre>
<pre><code>## Warning: Removed 326 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<ul>
<li>Since <code>alpha</code> isn’t specified in an aesthetic, it can’t
see the dataframe columns</li>
<li>You <strong>can</strong> do this inside an aesthetic too.</li>
<li>This generates a legend, which you normally don’t want.</li>
</ul>
</div>
<div id="line-plots" class="section level1">
<h1>Line plots</h1>
<p>There are, of course, more than just scatter plots. Line plots are
also quite common.</p>
<pre class="r"><code>ggplot(data = d2, aes(x = Week, y = Value)) +
  geom_line(aes(color=Cage))</code></pre>
<pre><code>## Warning: Removed 301 rows containing missing values (`geom_line()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<ul>
<li>Note that <code>NA</code>s are not removed but produce a warning. If
we filter them out then there won’t be a gap in the graph (I wouldn’t
recommend that, since it’s hiding the gap).</li>
</ul>
<pre class="r"><code>d3 = d2 %&gt;% filter(!is.na(Value))
ggplot(data = d3, aes(x=Week, y=Value)) +
  geom_line(aes(color=Cage))</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="exercise" class="section level1">
<h1>Exercise</h1>
<p>Can you make a scatter plot that also includes lines?</p>
<pre class="r"><code>ggplot(d2, aes(x = Week, y = Value)) +
  geom_line(aes(color = Cage)) +
  geom_point(aes(color = Group, shape = Group))</code></pre>
<pre><code>## Warning: Removed 301 rows containing missing values (`geom_line()`).</code></pre>
<pre><code>## Warning: Removed 326 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="labels" class="section level1">
<h1>Labels</h1>
<p>As noted previously, column names are used for things like axis and
legend titles. Since we typically keep these short but want the
displayed labels to be rather longer, these typically need to be
replaced.</p>
<pre class="r"><code>ggplot(data = d2, aes(x = Week, y = Value)) +
  geom_point(alpha=0.5, aes(color=Group, shape=Group)) +
  labs(x=&quot;Measurement week&quot;, y=&quot;Food intake (g)&quot;)</code></pre>
<pre><code>## Warning: Removed 326 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>If you’re the type of person that likes graph titles, then you can
add them as well (either with <code>title="something"</code> or adding a
<code>ggtitle("something")</code> layer).</p>
<ul>
<li>N.B., you can use symbols in your labels and such as well if you
need to:</li>
</ul>
<pre class="r"><code>ggplot(data = d2, aes(x = Week, y = Value)) +
  geom_point(alpha=0.5, aes(color=Group, shape=Group)) +
  labs(x=&quot;Measurement week&quot;, y=expression(paste(mu, &quot;A/&quot;, mu, &quot;F&quot;, sep=&quot;&quot;)))</code></pre>
<pre><code>## Warning: Removed 326 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<ul>
<li>You can do superscripts and basically anything else as well, though
at some point it’s faster to just modify things in Adobe Illustrator
than to google how to do that.</li>
</ul>
</div>
<div id="summarization-plots-geom_smooth" class="section level1">
<h1>Summarization plots: geom_smooth</h1>
<p>Lines and points show literally all of the information…which is
really hard to interpret. How might you use dplyr to get rid of all the
lines and plut the group average by week?</p>
<pre class="r"><code>d3 = d2 %&gt;% filter(!is.na(Value)) %&gt;% group_by(Group, Week) %&gt;% mutate(avg=mean(Value))
ggplot(data = d3, aes(x = Week, y = avg)) +
  geom_point(alpha=0.5, aes(color=Group, shape=Group)) +
  labs(x=&quot;Measurement week&quot;, y=&quot;Food intake (g)&quot;)</code></pre>
<p>But really what’s the fun of that when we can have ggplot do it for
us:</p>
<pre class="r"><code>ggplot(data = d2, aes(x = Week, y = Value)) +
  geom_smooth(aes(color=Group, fill=Group)) +
  labs(x=&quot;Measurement week&quot;, y=&quot;Food intake (g)&quot;)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 326 rows containing non-finite values (`stat_smooth()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/geom_smooth-1.png" width="672" /></p>
<p>The shaded regions are the 95% confidence intervals. The amount of
smoothing is controlled by the <code>span</code> parameter to
<code>geom_smooth()</code> and defaults to 0.75. Try spans of 0.1 or
0.3.</p>
<ul>
<li>N.B., the smoothing ends up filling the gap in the plot around week
28.</li>
<li>N.B., if you ever really need to, note that the smoothing is highly
customizable (e.g., you can use GLMs, logistic regression, etc.)</li>
</ul>
</div>
<div id="creating-facets" class="section level1">
<h1>Creating facets</h1>
<p>Let’s look again at the line plot:</p>
<pre class="r"><code>ggplot(data = d2, aes(x = Week, y = Value, group=Cage)) +
  geom_line(aes(color=Group)) +
  labs(x=&quot;Measurement week&quot;, y=&quot;Food intake (g)&quot;)</code></pre>
<pre><code>## Warning: Removed 301 rows containing missing values (`geom_line()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/facets-1.png" width="672" /></p>
<p>I’ve grouped each cage into its own line and then colored by group
(Not sure why the grouping was needed? Replot that without
<code>group=Cage</code>.). That’s nice, but the overlapping groups are
really messy. Ideally we’d just plot the groups independently.</p>
<pre class="r"><code>g = ggplot(data = d2, aes(x = Week, y = Value, group=Cage))
g = g + geom_line(aes(color=Cage))
g = g + labs(x=&quot;Measurement week&quot;, y=&quot;Food intake (g)&quot;)
g = g + facet_grid(Group~.)
g</code></pre>
<pre><code>## Warning: Removed 301 rows containing missing values (`geom_line()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<ul>
<li>You can facet things into columns or rows.</li>
</ul>
</div>
<div id="bar-box-violin-and-dot-plots." class="section level1">
<h1>Bar, box, violin and dot plots.</h1>
<p>The mouse food intake dataset isn’t so useful for bar/box plots.
Let’s use a different one:</p>
<pre class="r"><code>head(mpg)</code></pre>
<pre><code>## # A tibble: 6 x 11
##   manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
##   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 audi         a4      1.8  1999     4 auto(l5)   f        18    29 p     compa~
## 2 audi         a4      1.8  1999     4 manual(m5) f        21    29 p     compa~
## 3 audi         a4      2    2008     4 manual(m6) f        20    31 p     compa~
## 4 audi         a4      2    2008     4 auto(av)   f        21    30 p     compa~
## 5 audi         a4      2.8  1999     6 auto(l5)   f        16    26 p     compa~
## 6 audi         a4      2.8  1999     6 manual(m5) f        18    26 p     compa~</code></pre>
<p>The <code>mpg</code> package has fuel economy statistics for 38 car
models for the years 1999-2008. Let’s look at number of cars by
class.</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class))
g = g + geom_bar()
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>If you have a value that you’d like to use as the bar height, you can
use that instead, but you must then use the “identity” statistic instead
of count.</p>
<pre class="r"><code>mpg2 = mpg %&gt;% group_by(class) %&gt;% summarise(avg=mean(displ))
g = ggplot(data=mpg2, aes(x=class, y=avg))
g = g + geom_bar(stat=&quot;identity&quot;)
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>With multiple values per-class like this it’d be nicer to just make a
box plot.</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class, y=displ))
g = g + geom_boxplot()
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<ul>
<li>N.B., the plotted point are vaguely defined as outliers.</li>
</ul>
<p>Sometimes people want the points layered on top of the box plots
(mostly for seeing the number of observations). Layering is easy with
ggplot2.</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class, y=displ))
g = g + geom_boxplot()
g = g + geom_point(position=&quot;jitter&quot;, color=&quot;tomato&quot;)
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<ul>
<li>N.B., since ggplot builds images in layers in the order given, what
happens if you add the points and then the boxplot?</li>
</ul>
<p>The downside to box plots is that they hide the underlying data
(e.g., the <code>n</code>). For that reason, violin and dot (sometimes
call “beehive”) plots are increasingly popular.</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class, y=displ))
g = g + geom_violin()
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>By default, everything is scaled to the same area, but that can be
changed (so the <code>n</code> is apparent).</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class, y=displ))
g = g + geom_violin(scale=&quot;count&quot;)
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Now the 2 seater class is put in better perspective.</p>
<p>Of course black and white graphs are rather boring, so we tend to
color things and tweak the smoothing:</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class, y=displ))
g = g + geom_violin(scale=&quot;count&quot;, adjust=0.5, aes(color=class, fill=class))
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Often violin plots and dot plots are combined.</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class, y=displ))
g = g + geom_violin(scale=&quot;count&quot;, adjust=0.5)
g = g + geom_dotplot(binaxis=&quot;y&quot;, stackdir=&quot;center&quot;, dotsize=0.3, binwidth=0.1, aes(color=class, fill=class))
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
<div id="changing-the-orderlabels-and-general-tweaking"
class="section level1">
<h1>Changing the order/labels and general tweaking</h1>
<p>When R makes factors, it orders them alphabetically. Inevitably that
will produce an order that will drive your PI mad.</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class, y=displ))
g = g + geom_violin(scale=&quot;count&quot;, aes(color=class, fill=class))
g = g + scale_x_discrete(limits=c(&quot;subcompact&quot;, &quot;compact&quot;, &quot;midsize&quot;, &quot;minivan&quot;, &quot;pickup&quot;, &quot;suv&quot;, &quot;2seater&quot;))
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Similarly, group names are often chosen for ease of entry, not how
they should be displayed.</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class, y=displ))
g = g + geom_violin(scale=&quot;count&quot;, aes(color=class, fill=class))
g = g + scale_x_discrete(limits=c(&quot;subcompact&quot;, &quot;compact&quot;, &quot;midsize&quot;, &quot;minivan&quot;, &quot;pickup&quot;, &quot;suv&quot;, &quot;2seater&quot;),
                         labels=c(&quot;Subcompact&quot;, &quot;Compact&quot;, &quot;Midsize&quot;, &quot;Minivan&quot;, &quot;Pickup Truck&quot;, &quot;SUV&quot;, &quot;Sports Car&quot;))
g = g + labs(x=&quot;&quot;, y=&quot;Engine Displacement (liters)&quot;)
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>And half the time you’ll decide you don’t need the legend:</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class, y=displ))
g = g + geom_violin(scale=&quot;count&quot;, aes(color=class, fill=class))
g = g + scale_x_discrete(limits=c(&quot;subcompact&quot;, &quot;compact&quot;, &quot;midsize&quot;, &quot;minivan&quot;, &quot;pickup&quot;, &quot;suv&quot;, &quot;2seater&quot;),
                         labels=c(&quot;Subcompact&quot;, &quot;Compact&quot;, &quot;Midsize&quot;, &quot;Minivan&quot;, &quot;Pickup Truck&quot;, &quot;SUV&quot;, &quot;Sports Car&quot;))
g = g + labs(x=&quot;&quot;, y=&quot;Engine Displacement (liters)&quot;)
g = g + guides(fill=&quot;none&quot;, color=&quot;none&quot;)
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Or alternatively you just want to adjust the legend:</p>
<pre class="r"><code>g = ggplot(data=mpg, aes(x=class, y=displ))
g = g + geom_violin(scale=&quot;count&quot;, aes(fill=class))
g = g + scale_x_discrete(limits=c(&quot;subcompact&quot;, &quot;compact&quot;, &quot;midsize&quot;, &quot;minivan&quot;, &quot;pickup&quot;, &quot;suv&quot;, &quot;2seater&quot;),
                         labels=c(&quot;Subcompact&quot;, &quot;Compact&quot;, &quot;Midsize&quot;, &quot;Minivan&quot;, &quot;Pickup Truck&quot;, &quot;SUV&quot;, &quot;Sports Car&quot;))
g = g + labs(x=&quot;&quot;, y=&quot;Engine Displacement (liters)&quot;)
g = g + guides(fill=&quot;none&quot;, color=&quot;none&quot;)
g = g + scale_fill_discrete(name=&quot;Class&quot;,
                            limits=c(&quot;subcompact&quot;, &quot;compact&quot;, &quot;midsize&quot;, &quot;minivan&quot;, &quot;pickup&quot;, &quot;suv&quot;, &quot;2seater&quot;),
                            labels=c(&quot;Subcompact&quot;, &quot;Compact&quot;, &quot;Midsize&quot;, &quot;Minivan&quot;, &quot;Pickup Truck&quot;, &quot;SUV&quot;, &quot;Sports Car&quot;))
g</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<ul>
<li>N.B., if the outline colors are kept, then they should to be
reordered with <code>scale_color_discrete()</code> to match that of
<code>scale_fill_discrete()</code>.</li>
</ul>
<p>The other common annoying task is changing the colors. Inevitably
either you or your PI will want consistent colors used across different
figures, with each having vey different data.</p>
<pre class="r"><code>g2 = g + scale_fill_manual(name=&quot;Class&quot;,
                           limits=c(&quot;subcompact&quot;, &quot;compact&quot;, &quot;midsize&quot;, &quot;minivan&quot;, &quot;pickup&quot;, &quot;suv&quot;, &quot;2seater&quot;),
                           labels=c(&quot;Subcompact&quot;, &quot;Compact&quot;, &quot;Midsize&quot;, &quot;Minivan&quot;, &quot;Pickup Truck&quot;, &quot;SUV&quot;, &quot;Sports Car&quot;),
                           values=c(&quot;#FFFFFF&quot;, &quot;skyblue&quot;, &quot;indianred&quot;, &quot;chocolate&quot;, &quot;turquoise&quot;, &quot;darkorchid&quot;, &quot;aquamarine&quot;))</code></pre>
<pre><code>## Scale for fill is already present.
## Adding another scale for fill, which will replace the existing scale.</code></pre>
<pre class="r"><code>g2</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>You can use either names or hex values (e.g., “#FFFFFF”), with the
latter more useful for consistency across programs.</p>
<p>Some people hate the background grid, even though it helps in
comparing values, so you can always remove it. Compare the
following:</p>
<pre class="r"><code>g2 + theme_bw()</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<pre class="r"><code>g2 + theme_classic()</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-29-2.png" width="672" /></p>
<pre class="r"><code>g2 + theme(panel.background=element_blank(),
           axis.line.x=element_line(color=&quot;black&quot;),
           axis.line.y=element_line(color=&quot;black&quot;),
           axis.text.x=element_text(angle=-90, hjust=0, vjust=0.5))</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-29-3.png" width="672" /></p>
<p>Themes are just functions, so if you really want to you can write one
and then <code>+ theme_foo()</code> it on all of your plots.</p>
</div>
<div id="there-are-many-additional-possibilities"
class="section level1">
<h1>There are many additional possibilities</h1>
<p>This is just scratching the surface of what you can do with ggplot2.
As noted earlier, there’s a whole book on this if you really want. From
polar coordinates, to heatmaps to geographic maps, you can do pretty
much anything in ggplot2. Have a look at <a
href="http://docs.ggplot2.org/current/">the online manual</a> for many
more details.</p>
<p>Note that while you can change everything in ggplot, somethings are
probably simpler to do in Adobe Illustrator (or similar), since you’re
saving everything as a PDF anyway.</p>
</div>
<div id="exercise-1" class="section level1">
<h1>Exercise</h1>
<p>Load the <code>hflights.txt</code> file from <code>data/</code>. This
is another tab-separated dataset with a single header line. This is a
dataset containing information on flights departing Houston in 2011. Of
particular interest are the arrival times (<code>ArrTime</code>),
arrival delays times (<code>ArrDelay</code>) and day of the week
(<code>DayOfWeek</code>). Are you more likely to have a delay at any
particular time of day or day of the week? We don’t care about p-values,
we want differences we can actually see (i.e., something that we’d
notice as a passenger). <br> <br> <br> <br> <br> <br> <br> <br> <br>
<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br></p>
<pre class="r"><code>hflights = read_tsv(&quot;../data/hflights.txt&quot;)</code></pre>
<pre><code>## Rows: 227496 Columns: 21
## -- Column specification --------------------------------------------------------
## Delimiter: &quot;\t&quot;
## chr  (5): UniqueCarrier, TailNum, Origin, Dest, CancellationCode
## dbl (16): Year, Month, DayofMonth, DayOfWeek, DepTime, ArrTime, FlightNum, A...
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>ggplot(hflights, aes(x=factor(DayOfWeek), y=ArrDelay)) +
    geom_boxplot() + 
    xlab(&quot;Day of week&quot;) + ylab(&quot;Arrival Delay (Minutes)&quot;)</code></pre>
<pre><code>## Warning: Removed 3622 rows containing non-finite values (`stat_boxplot()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>No compelling difference in delay as a function of day. What about as
a function of time of day?</p>
<pre class="r"><code>ggplot(hflights, aes(x=ArrTime, y=ArrDelay)) + 
    geom_smooth(method=&quot;lm&quot;) +
    xlab(&quot;Time of day (HHMM)&quot;) + ylab(&quot;Delay (Minutes)&quot;)</code></pre>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 3622 rows containing non-finite values (`stat_smooth()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<pre class="r"><code>ggplot(hflights, aes(x=ArrTime)) + 
    geom_bar()</code></pre>
<pre><code>## Warning: Removed 3066 rows containing non-finite values (`stat_count()`).</code></pre>
<p><img src="12_ggplot2_files/figure-html/unnamed-chunk-31-2.png" width="672" /></p>
<p>There also isn’t really a delay according to time of day. Rather, you
tend to see more delays later in the day because there are more flights
then.</p>
</div>

<br />
<br />
<hr>
<p> Bioinfo Core @ MPI-IE Freiburg (2023) </p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
